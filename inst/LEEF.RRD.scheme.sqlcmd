
CREATE TABLE `flowcam__algae_density` (
  `date_flowcam` NUMERIC,
  `species` NUMERIC,
  `bottle` NUMERIC,
  `composition` NUMERIC,
  `temperature` NUMERIC,
  `incubator` NUMERIC,
  `volume_imaged` NUMERIC,
  `dilution_factor` NUMERIC,
  `richness` NUMERIC,
  `count` NUMERIC,
  `density` NUMERIC,
  `timestamp` NUMERIC
);
CREATE INDEX idx_flowcam__algae_density_timetamp on flowcam__algae_density(timestamp);
CREATE INDEX idx_flowcam__algae_density_bottle on flowcam__algae_density(bottle);
CREATE INDEX idx_flowcam__algae_density_timestamp_bottle on flowcam__algae_density(timestamp, bottle);


CREATE TABLE `flowcytometer__flowcytometer_density` (
  `timestamp` NUMERIC,
  `filename` NUMERIC,
  `bottle` NUMERIC,
  `date` NUMERIC,
  `sample` NUMERIC,
  `volume` NUMERIC,
  `total.counts` NUMERIC,
  `tot_density_perml` NUMERIC,
  `specname` NUMERIC,
  `dilution_factor` NUMERIC,
  `sample_letter` NUMERIC,
  `sample_number` NUMERIC,
  `species` NUMERIC,
  `count` NUMERIC,
  `density` NUMERIC
);
CREATE INDEX idx_flowcytometer__flowcytometer_density_timetamp on flowcytometer__flowcytometer_density(timestamp);
CREATE INDEX idx_flowcytometer__flowcytometer_density_bottle on flowcytometer__flowcytometer_density(bottle);
CREATE INDEX idx_flowcytometer__flowcytometer_density_timestamp_bottle on flowcytometer__flowcytometer_density(timestamp, bottle);


CREATE TABLE `manualcount__manualcount_density` (
  `timestamp` NUMERIC,
  `bottle` NUMERIC,
  `species` NUMERIC,
  `ml_counted` NUMERIC,
  `count` NUMERIC,
  `density` NUMERIC
);
CREATE INDEX idx_manualcount__manualcount_density_timetamp on manualcount__manualcount_density(timestamp);
CREATE INDEX idx_manualcount__manualcount_density_bottle on manualcount__manualcount_density(bottle);
CREATE INDEX idx_manualcount__manualcount_density_timestamp_bottle on manualcount__manualcount_density(timestamp, bottle);


CREATE TABLE `o2meter__o2meter` (
  `timestamp` NUMERIC,
  `bottle` NUMERIC,
  `sensor` NUMERIC,
  `date` NUMERIC,
  `time` NUMERIC,
  `channel` NUMERIC,
  `user` NUMERIC,
  `sensorid` NUMERIC,
  `sensor_name` NUMERIC,
  `delta_t` NUMERIC,
  `time_unit` NUMERIC,
  `value` NUMERIC,
  `o2_unit` NUMERIC,
  `mode` NUMERIC,
  `phase` NUMERIC,
  `phase_unit` NUMERIC,
  `amplitude` NUMERIC,
  `amplitude_unit` NUMERIC,
  `temp` NUMERIC,
  `temp_unit` NUMERIC,
  `pressure` NUMERIC,
  `pressure_unit` NUMERIC,
  `salinity` NUMERIC,
  `salinity_unit` NUMERIC,
  `error` NUMERIC,
  `cal0` NUMERIC,
  `cal0_unit` NUMERIC,
  `t0` NUMERIC,
  `t0_unit` NUMERIC,
  `o2cal2nd` NUMERIC,
  `o2_unit1` NUMERIC,
  `cal2nd` NUMERIC,
  `cal2nd_unit` NUMERIC,
  `t2nd` NUMERIC,
  `t2nd_unit` NUMERIC,
  `calpressure` NUMERIC,
  `calpressure_unit` NUMERIC,
  `f1` NUMERIC,
  `dphi1` NUMERIC,
  `dksv1` NUMERIC,
  `dphi2` NUMERIC,
  `dksv2` NUMERIC,
  `m` NUMERIC,
  `cal_mode` NUMERIC,
  `signalledcurrent` NUMERIC,
  `user_signal_intensity` NUMERIC,
  `referenceledcurrent` NUMERIC,
  `reference_amplitude` NUMERIC,
  `device_serial` NUMERIC,
  `fwversion` NUMERIC,
  `swversion` NUMERIC,
  `sensor_type` NUMERIC,
  `batchid` NUMERIC,
  `calibration_date` NUMERIC,
  `sensor_lot` NUMERIC,
  `presens_calibr` NUMERIC,
  `battery_voltage` NUMERIC,
  `battery_voltage_unit` NUMERIC
);
CREATE INDEX idx_o2meter__o2meter_timetamp on o2meter__o2meter(timestamp);
CREATE INDEX idx_o2meter__o2meter_bottle on o2meter__o2meter(bottle);
CREATE INDEX idx_o2meter__o2meter_timestamp_bottle on o2meter__o2meter(timestamp, bottle);


CREATE TABLE `bemovi_mag_16__mean_density_per_ml` (
  `timestamp` NUMERIC,
  `date` NUMERIC,
  `species` NUMERIC,
  `composition_id` NUMERIC,
  `bottle` NUMERIC,
  `temperature_treatment` NUMERIC,
  `magnification` NUMERIC,
  `sample` NUMERIC,
  `density` NUMERIC
);
CREATE INDEX idx_bemovi_mag_16__mean_density_per_ml_timetamp on bemovi_mag_16__mean_density_per_ml(timestamp);
CREATE INDEX idx_bemovi_mag_16__mean_density_per_ml_bottle on bemovi_mag_16__mean_density_per_ml(bottle);
CREATE INDEX idx_bemovi_mag_16__mean_density_per_ml_timestamp_bottle on bemovi_mag_16__mean_density_per_ml(timestamp, bottle);


CREATE TABLE `bemovi_mag_25__mean_density_per_ml_cropped` (
  `timestamp` NUMERIC,
  `date` NUMERIC,
  `species` NUMERIC,
  `composition_id` NUMERIC,
  `bottle` NUMERIC,
  `temperature_treatment` NUMERIC,
  `magnification` NUMERIC,
  `sample` NUMERIC,
  `density` NUMERIC
);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_cropped_timetamp on bemovi_mag_25__mean_density_per_ml_cropped(timestamp);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_cropped_bottle on bemovi_mag_25__mean_density_per_ml_cropped(bottle);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_cropped_timestamp_bottle on bemovi_mag_25__mean_density_per_ml_cropped(timestamp, bottle);


CREATE TABLE `bemovi_mag_25__mean_density_per_ml` (
  `timestamp` NUMERIC,
  `date` NUMERIC,
  `species` NUMERIC,
  `composition_id` NUMERIC,
  `bottle` NUMERIC,
  `temperature_treatment` NUMERIC,
  `magnification` NUMERIC,
  `sample` NUMERIC,
  `density` NUMERIC
);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_timetamp on bemovi_mag_25__mean_density_per_ml(timestamp);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_bottle on bemovi_mag_25__mean_density_per_ml(bottle);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_timestamp_bottle on bemovi_mag_25__mean_density_per_ml(timestamp, bottle);



CREATE TABLE `bemovi_mag_25__mean_density_per_ml_non_cropped` (
  `timestamp` NUMERIC,
  `date` NUMERIC,
  `species` NUMERIC,
  `composition_id` NUMERIC,
  `bottle` NUMERIC,
  `temperature_treatment` NUMERIC,
  `magnification` NUMERIC,
  `sample` NUMERIC,
  `density` NUMERIC
);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_non_cropped_timetamp on bemovi_mag_25__mean_density_per_ml_non_cropped(timestamp);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_non_cropped_bottle on bemovi_mag_25__mean_density_per_ml_non_cropped(bottle);
CREATE INDEX idx_bemovi_mag_25__mean_density_per_ml_non_cropped_timestamp_bottle on bemovi_mag_25__mean_density_per_ml_non_cropped(timestamp, bottle);


CREATE VIEW o2
AS
SELECT
  *
FROM
  (
   SELECT
     timestamp,
     cast(
          julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) -
          julianday('2021-09-20') AS NUMERIC
     ) AS day,
     bottle,
     sensor,
     temp AS 'temperature_actual',
     value AS 'percent_o2',
     'o2meter' AS measurement
   FROM
     o2meter__o2meter
  )
INNER JOIN
  (
   SELECT
     bottle,
     temperature,
     richness,
     composition,
     incubator
   FROM
	 experimetal_design
  )
USING
  (bottle);


CREATE VIEW density
AS
SELECT
  *
FROM
  (
   SELECT
     timestamp,
     cast( julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) - julianday('2021-09-20') as NUMERIC ) AS day,
     bottle,
     'bemovi_mag_16' AS measurement,
     species,
     density
   FROM
     bemovi_mag_16__mean_density_per_ml
   UNION ALL
   SELECT
     timestamp,
     cast( julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) - julianday('2021-09-20') as NUMERIC ) AS day,
     bottle,
     'bemovi_mag_25' AS measurement,
     species,
     density
   FROM
     bemovi_mag_25__mean_density_per_ml
   UNION ALL
   SELECT
     timestamp,
     cast( julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) - julianday('2021-09-20') as NUMERIC ) AS day,
     bottle,
     'bemovi_mag_25_cropped' AS measurement,
     species,
     density
   FROM
     bemovi_mag_25__mean_density_per_ml_cropped
   UNION ALL
   SELECT
     timestamp,
     cast( julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) - julianday('2021-09-20') as NUMERIC ) AS day,
     bottle,
     'bemovi_mag_25_non_cropped' AS measurement,
     species,
     density
   FROM
     bemovi_mag_25__mean_density_per_ml_non_cropped
   UNION ALL
   SELECT
     timestamp,
     cast( julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) - julianday('2021-09-20') as NUMERIC ) AS day,
     bottle,
     'flowcam' AS measurement,
     species,
     density
   FROM
     flowcam__algae_density
   UNION ALL
   SELECT
     timestamp,
     cast( julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) - julianday('2021-09-20') as NUMERIC ) AS day,
     bottle,
     'flowcytometer' AS measurement,
     species,
     density
   FROM
     flowcytometer__flowcytometer_density
   UNION ALL
   SELECT
     timestamp,
     cast( julianday(date(substr(timestamp,1,4)||'-'||substr(timestamp,5,2)||'-'||substr(timestamp,7,2))) - julianday('2021-09-20') as NUMERIC ) AS day,
     bottle,
     'manualcount' AS measurement,
     species,
     density
   FROM
     manualcount__manualcount_density
  )
INNER JOIN
  (
   SELECT
     bottle,
     temperature,
     richness,
     composition,
     incubator
   FROM
	 experimetal_design
  )
USING
  (bottle);
